<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifica√ß√µes de Anivers√°rio - WhatsApp</title>
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2b6cb0;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --error-color: #e53e3e;
            --light-color: #f7fafc;
            --dark-color: #2d3748;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .description {
            text-align: center;
            margin-bottom: 30px;
            color: #666;
        }
        
        .birthday-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #90caf9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .birthday-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .birthday-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .birthday-info h3 {
            margin-bottom: 5px;
            color: #1565c0;
        }
        
        .birthday-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            gap: 8px;
        }
        
        .btn-whatsapp {
            background-color: #25D366;
            color: white;
        }
        
        .btn-whatsapp:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
        }
        
        .btn-copy {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-copy:hover {
            background-color: #2c5282;
            transform: translateY(-2px);
        }
        
        .btn-test {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-test:hover {
            background-color: #b7791f;
            transform: translateY(-2px);
        }
        
        .btn-send {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-send:hover {
            background-color: #2f855a;
            transform: translateY(-2px);
        }
        
        .message-preview {
            background-color: #f1f1f1;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            font-style: italic;
            border-left: 4px solid var(--secondary-color);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
        }
        
        .config-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-control:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        }
        
        .no-birthdays {
            text-align: center;
            padding: 30px;
            color: #666;
        }
        
        .auto-notification {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .auto-notification h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .auto-notification p {
            margin-bottom: 10px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--success-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .toggle-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .auto-send-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f0f9ff;
            border-left: 4px solid var(--secondary-color);
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active {
            background-color: var(--success-color);
        }
        
        .status-inactive {
            background-color: var(--error-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéâ Notifica√ß√µes de Anivers√°rio</h1>
        <p class="description">Envie automaticamente mensagens de anivers√°rio para o grupo do WhatsApp</p>
        
        <div id="birthdays-container">
            <!-- Aniversariantes do dia ser√£o inseridos aqui -->
        </div>
        
        <div class="config-section">
            <h3>Configura√ß√µes de Notifica√ß√£o</h3>
            
            <div class="auto-notification">
                <h4>Notifica√ß√£o Autom√°tica</h4>
                <p>Ative para enviar automaticamente mensagens de anivers√°rio para o grupo do WhatsApp</p>
                
                <div class="toggle-label">
                    <label for="autoNotification">Notifica√ß√£o autom√°tica:</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoNotification">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div id="autoSendStatus" class="auto-send-status" style="display: none;">
                    <p><span class="status-indicator status-active"></span> <strong>Notifica√ß√£o autom√°tica ativa</strong></p>
                    <p>As mensagens ser√£o enviadas automaticamente √†s 9h para os aniversariantes do dia.</p>
                </div>
                
                <div class="form-group">
                    <label for="whatsappGroup">Link do Grupo do WhatsApp</label>
                    <input type="text" id="whatsappGroup" class="form-control" value="https://chat.whatsapp.com/ExSgIpveZoJ4Gkes3CxYhX" readonly>
                    <small style="color: #666;">Link do grupo configurado para envio autom√°tico</small>
                </div>
                
                <div class="form-group">
                    <label for="customMessage">Mensagem Personalizada</label>
                    <textarea id="customMessage" class="form-control" rows="3" placeholder="Personalize a mensagem que ser√° enviada..."></textarea>
                    <small style="color: #666;">Use {nome} para incluir o nome do aniversariante</small>
                </div>
                
                <div class="birthday-actions">
                    <button class="btn btn-test" onclick="testNotification()">Testar Notifica√ß√£o</button>
                    <button class="btn btn-send" onclick="sendManualNotification()" id="sendManualBtn">
                        <span>üì§</span> Enviar Agora
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        Mensagem copiada para a √°rea de transfer√™ncia!
    </div>

    <script>
        // Dados de exemplo - substitua pelos dados reais do seu sistema
        const members = [
            { id: 1, name: "Jo√£o Silva", role: "Desenvolvedor", birthday: new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()) },
            { id: 2, name: "Maria Santos", role: "Designer", birthday: new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate() + 1) },
            { id: 3, name: "Pedro Oliveira", role: "Gerente", birthday: new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate() - 1) }
        ];

        // Configura√ß√µes
        let config = {
            autoNotification: false,
            whatsappGroup: "https://chat.whatsapp.com/ExSgIpveZoJ4Gkes3CxYhX",
            customMessage: "üéâ Hoje √© o anivers√°rio de {nome}! üéÇ\n\nDesejamos um feliz anivers√°rio, que este seja um dia especial e que todos os seus sonhos se realizem! ü•≥\n\nCom carinho,\nEquipe Network In Foco"
        };

        // Carregar configura√ß√µes salvas
        function loadConfig() {
            const savedConfig = localStorage.getItem('whatsappBirthdayConfig');
            if (savedConfig) {
                config = { ...config, ...JSON.parse(savedConfig) };
                document.getElementById('autoNotification').checked = config.autoNotification;
                document.getElementById('whatsappGroup').value = config.whatsappGroup || "";
                document.getElementById('customMessage').value = config.customMessage;
                
                // Atualizar status da notifica√ß√£o autom√°tica
                updateAutoSendStatus();
            }
        }

        // Salvar configura√ß√µes
        function saveConfig() {
            config.autoNotification = document.getElementById('autoNotification').checked;
            config.whatsappGroup = document.getElementById('whatsappGroup').value;
            config.customMessage = document.getElementById('customMessage').value;
            localStorage.setItem('whatsappBirthdayConfig', JSON.stringify(config));
            
            // Atualizar status da notifica√ß√£o autom√°tica
            updateAutoSendStatus();
            
            // Reiniciar a verifica√ß√£o autom√°tica se necess√°rio
            if (config.autoNotification) {
                setupDailyCheck();
            }
            
            showNotification('Configura√ß√µes salvas!');
        }

        // Atualizar status do envio autom√°tico
        function updateAutoSendStatus() {
            const statusElement = document.getElementById('autoSendStatus');
            if (config.autoNotification) {
                statusElement.style.display = 'block';
            } else {
                statusElement.style.display = 'none';
            }
        }

        // Verificar anivers√°rios do dia
        function getTodaysBirthdays() {
            const today = new Date();
            const todayMonth = today.getMonth();
            const todayDate = today.getDate();
            
            return members.filter(member => {
                if (!member.birthday) return false;
                
                const birthday = new Date(member.birthday);
                return birthday.getMonth() === todayMonth && birthday.getDate() === todayDate;
            });
        }

        // Gerar mensagem personalizada
        function generateMessage(member) {
            let message = config.customMessage || "üéâ Hoje √© o anivers√°rio de {nome}! üéÇ\n\nDesejamos um feliz anivers√°rio!";
            return message.replace(/{nome}/g, member.name);
        }

        // Gerar link do WhatsApp para envio manual
        function generateWhatsAppLink(member) {
            const message = encodeURIComponent(generateMessage(member));
            return `https://wa.me/?text=${message}`;
        }

        // Enviar notifica√ß√£o autom√°tica
        function sendAutoNotification() {
            if (!config.autoNotification) return;
            
            const todaysBirthdays = getTodaysBirthdays();
            if (todaysBirthdays.length === 0) {
                console.log("Nenhum aniversariante hoje");
                return;
            }
            
            // Para cada aniversariante, enviar mensagem
            todaysBirthdays.forEach(member => {
                sendWhatsAppMessage(member);
            });
            
            console.log(`Notifica√ß√µes enviadas para ${todaysBirthdays.length} aniversariante(s)`);
        }

        // Enviar mensagem via WhatsApp (simula√ß√£o)
        function sendWhatsAppMessage(member) {
            const message = generateMessage(member);
            
            // Em um ambiente real, voc√™ usaria uma API para enviar a mensagem
            // Como estamos no navegador, apenas simulamos o envio
            
            // Abrir o WhatsApp Web com a mensagem pr√©-preenchida
            // Note: O WhatsApp Web n√£o permite envio autom√°tico para grupos via URL
            // Esta √© uma limita√ß√£o de seguran√ßa do WhatsApp
            
            // Para envio individual:
            const whatsappUrl = `https://web.whatsapp.com/send?text=${encodeURIComponent(message)}`;
            
            // Para grupos, precisar√≠amos de uma solu√ß√£o diferente, como:
            // 1. Usar a API Business do WhatsApp (requer aprova√ß√£o)
            // 2. Usar automa√ß√£o com Puppeteer/Selenium (n√£o recomendado para produ√ß√£o)
            // 3. Usar servi√ßos de terceiros que oferecem API para WhatsApp
            
            // Por enquanto, apenas registramos no console
            console.log(`Mensagem para ${member.name}: ${message}`);
            
            // Em um ambiente de produ√ß√£o, voc√™ implementaria a l√≥gica real de envio aqui
            // Por exemplo, usando a API oficial do WhatsApp Business
            
            return true;
        }

        // Enviar notifica√ß√£o manual
        function sendManualNotification() {
            const todaysBirthdays = getTodaysBirthdays();
            if (todaysBirthdays.length === 0) {
                showNotification('Nenhum aniversariante hoje para notificar', 'error');
                return;
            }
            
            // Desabilitar bot√£o durante o envio
            const sendBtn = document.getElementById('sendManualBtn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span>‚è≥</span> Enviando...';
            
            // Simular envio (em produ√ß√£o, substituir pela l√≥gica real)
            setTimeout(() => {
                todaysBirthdays.forEach(member => {
                    sendWhatsAppMessage(member);
                });
                
                showNotification(`Mensagens enviadas para ${todaysBirthdays.length} aniversariante(s)!`);
                
                // Reabilitar bot√£o
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<span>üì§</span> Enviar Agora';
            }, 2000);
        }

        // Copiar mensagem para a √°rea de transfer√™ncia
        function copyToClipboard(memberId) {
            const member = members.find(m => m.id === memberId);
            if (!member) return;
            
            const message = generateMessage(member);
            navigator.clipboard.writeText(message).then(() => {
                showNotification('Mensagem copiada para a √°rea de transfer√™ncia!');
            }).catch(err => {
                console.error('Erro ao copiar mensagem: ', err);
                showNotification('Erro ao copiar mensagem', 'error');
            });
        }

        // Mostrar notifica√ß√£o
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            notification.style.backgroundColor = type === 'error' ? 'var(--error-color)' : 'var(--success-color)';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Renderizar aniversariantes
        function renderBirthdays() {
            const container = document.getElementById('birthdays-container');
            const todaysBirthdays = getTodaysBirthdays();
            
            if (todaysBirthdays.length === 0) {
                container.innerHTML = `
                    <div class="no-birthdays">
                        <h3>Nenhum aniversariante hoje</h3>
                        <p>N√£o h√° membros fazendo anivers√°rio hoje.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = todaysBirthdays.map(member => `
                <div class="birthday-card">
                    <div class="birthday-header">
                        <div class="birthday-icon">üéÇ</div>
                        <div class="birthday-info">
                            <h3>${member.name}</h3>
                            <p>${member.role} ‚Ä¢ Aniversariante de Hoje!</p>
                        </div>
                    </div>
                    
                    <div class="message-preview">
                        ${generateMessage(member)}
                    </div>
                    
                    <div class="birthday-actions">
                        <a href="${generateWhatsAppLink(member)}" target="_blank" class="btn btn-whatsapp">
                            <span>üì±</span> Abrir WhatsApp
                        </a>
                        <button class="btn btn-copy" onclick="copyToClipboard(${member.id})">
                            <span>üìã</span> Copiar Mensagem
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Testar notifica√ß√£o
        function testNotification() {
            if (members.length > 0) {
                copyToClipboard(members[0].id);
            } else {
                showNotification('N√£o h√° membros para testar', 'error');
            }
        }

        // Verifica√ß√£o autom√°tica di√°ria
        function setupDailyCheck() {
            if (config.autoNotification) {
                // Verificar uma vez por dia √†s 9h
                const now = new Date();
                const lastCheck = localStorage.getItem('lastBirthdayCheck');
                const today = now.toDateString();
                
                // Se ainda n√£o verificamos hoje, verificar agora
                if (lastCheck !== today) {
                    const todaysBirthdays = getTodaysBirthdays();
                    if (todaysBirthdays.length > 0) {
                        // Enviar notifica√ß√µes automaticamente
                        sendAutoNotification();
                        showNotification(`Notifica√ß√µes autom√°ticas enviadas para ${todaysBirthdays.length} aniversariante(s)!`);
                    }
                    
                    localStorage.setItem('lastBirthdayCheck', today);
                }
                
                // Agendar pr√≥xima verifica√ß√£o para amanh√£ √†s 9h
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(9, 0, 0, 0);
                
                const timeUntilTomorrow = tomorrow.getTime() - now.getTime();
                setTimeout(setupDailyCheck, timeUntilTomorrow);
                
                console.log('Pr√≥xima verifica√ß√£o autom√°tica agendada para:', tomorrow);
            } else {
                // Se n√£o est√° ativado, verificar novamente em 1 hora
                setTimeout(setupDailyCheck, 60 * 60 * 1000);
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            renderBirthdays();
            setupDailyCheck();
            
            // Salvar configura√ß√µes quando alteradas
            document.getElementById('autoNotification').addEventListener('change', saveConfig);
            document.getElementById('whatsappGroup').addEventListener('change', saveConfig);
            document.getElementById('customMessage').addEventListener('change', saveConfig);
        });

        // Para integrar com o sistema existente, voc√™ precisar√°:
        // 1. Substituir o array "members" pelos dados reais do seu sistema
        // 2. Chamar renderBirthdays() quando os dados forem carregados
        // 3. Implementar a l√≥gica real de envio via API do WhatsApp Business
    </script>
</body>
</html>
